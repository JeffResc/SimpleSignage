name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build-image:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout ğŸ›ï¸
      uses: actions/checkout@v2
    - name: Set up QEMU ğŸ”§
      id: qemu
      uses: docker/setup-qemu-action@v1
      with:
        image: tonistiigi/binfmt:latest
        platforms: all
    - name: Build the Docker image ğŸ‹
      run: docker build . -t simplesignage:$(date +%s)
  balena-deploy:
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    needs: [build-image]
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2
      - name: Setup NodeJS ğŸ’
        uses: actions/setup-node@v1.1.0
      - name: Balena Deploy ğŸš€
        uses: theaccordance/balena-push@v1.0.0
        with:
          api-token: ${{secrets.BALENA_API_TOKEN}}
          application-name: ${{secrets.BALENA_APPLICATION_NAME}}
          application-path: "./"

